<!DOCTYPE html>
<html xmlns:layout="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.w3.org/1999/xhtml" layout:decorate="~{layout}">
<head>
<meta charset="UTF-8" />

<link rel="stylesheet"
	href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
<script type="text/javascript"
	src="https://www.gstatic.com/charts/loader.js"></script>
<link th:href="@{/css/style.css(v=${version})}" rel="stylesheet" />
<link th:href="@{/css/style-estatisticas.css(v=${version})}"
	rel="stylesheet" />

</head>
<body>

	<section class="layout-content" layout:fragment="corpo">
		<main role="main">

			<section class="jumbotron text-center">
				<div class="container">
					<h1 class="jumbotron-heading">Estatísticas de Inscrições</h1>
				</div>
			</section>

			<div class="album py-5 bg-light">
				<div class="container">


					<div class="row">
						<div
							class="col-xl-3 col-lg-3 col-md-3 col-sm-6 grid-margin stretch-card ">
							<div class="card card-statistics shadow p-3 "
								style="height: 100%">
								<div class="card-body">
									<div class="clearfix">
										<div class="float-left">
											<i class="mdi mdi-cube text-danger icon-lg"></i> <i
												class="bi bi-check-circle-fill text-success icon-lg"></i>
										</div>
										<div class="float-right">
											<p class="mb-0 text-right ">Inscrições</p>
											<div class="fluid-container">
												<h3 class="font-weight-medium text-right mb-0">[(${quantidadeInscricao})]</h3>
											</div>
										</div>
									</div>
									<p class="text-muted mt-3 mb-0">
										<i class="mdi mdi-alert-octagon mr-1" aria-hidden="true"></i>
										Todas as inscrições realizadas
									</p>
								</div>
							</div>
						</div>
						<div
							class="col-xl-3 col-lg-3 col-md-3 col-sm-6 grid-margin stretch-card">
							<div class="card card-statistics shadow p-3" style="height: 100%">
								<div class="card-body">
									<div class="clearfix">
										<div class="float-left">
											<i class="bi bi-bank2 icon-lg"
												style="height: auto; width: 50px; color: blue;"></i>
										</div>
										<div class="float-right">
											<p class="mb-0 text-right">Cursos</p>
											<div class="fluid-container">
												<h3 class="font-weight-medium text-right mb-0">[(${quantidadeCursos})]</h3>
											</div>
										</div>
									</div>
									<p class="text-muted mt-3 mb-0">
										<i class="mdi mdi-bookmark-outline mr-1" aria-hidden="true"></i>
										Cursos cadastrados
									</p>
								</div>
							</div>
						</div>
						<div
							class="col-xl-3 col-lg-3 col-md-3 col-sm-6 grid-margin stretch-card">
							<div class="card card-statistics shadow p-3" style="height: 100%">
								<div class="card-body">
									<div class="clearfix">
										<div class="float-left">
											<i class="bi bi-person-fill text-success icon-lg"></i>
										</div>
										<div class="float-right">
											<p class="mb-0 text-right">Candidatos</p>
											<div class="fluid-container">
												<h3 class="font-weight-medium text-right mb-0">[(${quantidadeCandidatos})]</h3>
											</div>
										</div>
									</div>
									<p class="text-muted mt-3 mb-0">
										<i class="mdi mdi-calendar mr-1" aria-hidden="true"></i>
										Candidatos cadastrados
									</p>
								</div>
							</div>
						</div>
						<div
							class="col-xl-3 col-lg-3 col-md-3 col-sm-6 grid-margin stretch-card">
							<div class="card card-statistics shadow p-3" style="height: 100%">
								<div class="card-body">
									<div class="clearfix">
										<div class="float-left">
											<i class="bi bi-person-workspace text-warning"></i>
										</div>
										<div class="float-right">
											<p class="mb-0 text-right">Usuarios</p>
											<div class="fluid-container">
												<h3 class="font-weight-medium text-right mb-0">[(${quantidadeUsuarios})]</h3>
											</div>
										</div>
									</div>
									<p class="text-muted mt-3 mb-0">
										<i class="mdi mdi-reload mr-1" aria-hidden="true"></i>
										Usuarios cadastrados
									</p>
								</div>
							</div>
						</div>
					</div>

					<div class="row" style="margin-top: 30px;">
						<div class="col-md-12">

							<div
								class="shadow p-3 mb-5 bg-white rounded card card-statistics"
								style="background-color: white; border-radius: 20px;">
								<h4 style="padding-top: 25px; padding-left: 25px;">Inscrições
									por curso cadastrado:</h4>
								<hr style="width: 95%;" />
								<div id="grafico"
									style="display: flex; flex-direction: row; justify-content: center; align-items: center; background-color: white; border-radius: 20px;">

									<div id="chart_div" style="width: 100%; min-height: 300px;"></div>
								</div>
							</div>


						</div>
					</div>

					<div class="row">
						<div class="col-md-12">

							<div
								class="shadow p-3 mb-5 bg-white rounded card card-statistics"
								style="background-color: white; border-radius: 20px;">
								<h4 style="padding-top: 25px; padding-left: 25px;">Inscrições
									por Dia:</h4>
								<hr style="width: 95%;" />
								<div id="grafico-data"
									style="display: flex; flex-direction: row; justify-content: center; align-items: center; background-color: white; border-radius: 20px;">

									<div id="columnchart_values"
										style="width: 100%; min-height: 400px;"></div>
								</div>
							</div>


						</div>
					</div>

					<div class="row" style="">
						<div class="col-md-12">

							<div
								class="shadow p-3 mb-5 bg-white rounded card card-statistics"
								style="background-color: white; border-radius: 20px;">
								<h4 style="padding-top: 25px; padding-left: 25px;">Inscritos por Bairro:</h4>
								<hr style="width: 95%;" />
								
								<ul class="list-group">
									<li class="list-group-item" th:each="bairro : ${bairros}" th:value="${bairro}"
									th:text="${bairro}"></li>
								</ul>
							</div>


						</div>
					</div>

					<!-- 				<div class="form-row col-lg-12" style="width: 100%;"> -->
					<!-- 								<div class="form-group col-lg-12" style="width: 100%;"> -->
					<!-- 									<label for="curso">Cursos Disponíveis</label> <select id="curso" style="width: 100%;" size="5" -->
					<!-- 										class="form-control col-lg-12" th:field="*{curso}" -->
					<!-- 										th:classappend="${#fields.hasErrors('curso')} ? 'is-invalid'"> -->
					<!-- 										<option th:each="c : ${cursos}" th:value="${c.id}" th:if="${c.ativo} == true" -->
					<!-- 											th:text="${c.titulo}+ ' - ' + ${c.cargaHoraria}+' horas' + -->
					<!-- 											 ' - ' + (${c.turno} == 1 ? 'Manhã' -->
					<!-- 											  : (${c.turno} == 2 ? 'Tarde': 'Noite') ) "></option> -->
					<!-- 									</select> -->
					<!-- 									<div class="invalid-feedback"> -->
					<!-- 										<span th:errors="*{curso}"></span> -->
					<!-- 									</div> -->
					<!-- 								</div> -->
					<!-- 							</div> -->
					<!-- 				<div class="row" > -->
					<!-- 					<div class="col-md-12"> -->

					<!-- 						<div class="shadow p-3 mb-5 bg-white rounded card card-statistics" -->
					<!-- 							style="background-color: white; border-radius: 20px;"> -->
					<!-- 							<h4 style="padding-top: 25px; padding-left: 25px;">Inscrições por Data (Em desenvolvimento):</h4> -->
					<!-- 							<hr style="width: 95%;" /> -->
					<!-- 							<br> -->
					<!-- 							<div style="margin-left: 20px;"> -->
					<!-- 								<p id="inscricao_por_data"></p> -->
					<!-- 							</div> -->

					<!-- 						</div> -->


					<!-- 					</div> -->
					<!-- 				</div> -->
				</div>
			</div>

		</main>

	</section>
	<script th:src="@{/js/estatisticas.js(v=${version})}" th:fragment="js"></script>
	<script th:inline="javascript" th:fragment="inlinescript">
	
    google.charts.load('current', {'packages':['corechart']});
    google.charts.setOnLoadCallback(drawChart);
    var qtdInscricaoPorData_html = new Array();
    var qtdInscricaoPorData = new Array();
    
    function drawChart() {
    	var classificacao = new Array();
    	classificacao = lerInscricoes();
      var data = new google.visualization.DataTable();
      data.addColumn('string', 'Curso');
      data.addColumn('number', 'Inscrições');
      console.log(classificacao);
      var i = 0;
      	[# th:each="curso : ${cursos}"]  

      		var str = [[${curso.titulo}]];
//       		console.log(str);
      		data.addRows([
            	[classificacao[i][0],classificacao[i][1] ],
          	]);
      		i++;
    	[/]

      var options = {
    		  //legend: 'none',
    	      pieSliceText: 'data'+ 'label',
    	      title: 'Inscrições por curso',
    	      //pieStartAngle: 100,
    	      pieHole: 0.3,
      };

      var chart = new google.visualization.PieChart(document.getElementById('chart_div'));
      chart.draw(data, options);
    }
    
    var lerInscricoes = function() {
    	var classificacao = new Array();
    	var datas = new Array();
    	var listaDatas = new Array();
    	
    	
    	
    	[# th:each="inscricao : ${inscricoes}"]   
		
			var dtInscricao = [[${inscricao.dtInscricao}]];
			
// 			console.log("dtinscricao: " + dtInscricao);
// 			console.log("find: " + datas.includes(dtInscricao));
			if (datas.includes(dtInscricao)) {
// 				console.log
// 				console.log("Data já registrada: " + dtInscricao);
			} else {
// 				console.log("Não possui esta data em registro: "+dtInscricao);
				datas.push(dtInscricao)
			}
			listaDatas.push(dtInscricao)
		[/]
		
// 			console.log("datas: "+datas);
// 			console.log("Tamanho datas: "+datas.length);
// 			console.log("listaDatas: "+listaDatas);
			
// 			var quantidadeElementos = listaDatas.filter(x => x === "2022-05-26").length;
// 			console.log("O array possui " + quantidadeElementos + " elementos iguais a '2022-05-26'")
			
			
			for (let i = 0; i < datas.length; i++) {
				var quantidadeElementos = listaDatas.filter(x => x === datas[i]).length;
				
				qtdInscricaoPorData[i] = [datas[i], quantidadeElementos];
			}
			qtdInscricaoPorData = qtdInscricaoPorData.sort()
// 			console.log("qtdInscricaoPorData: "+qtdInscricaoPorData)
// 			console.log("qtdInscricaoPorData index 0: "+qtdInscricaoPorData[0])
			
// 			for (let i = 0; i < qtdInscricaoPorData.length; i++) {
// 				qtdInscricaoPorData_html.push( '<p><b>Dia '+ qtdInscricaoPorData[i][0] +'</b>: '+ qtdInscricaoPorData[i][1] +' Inscrições</p>'
// 				);
// 			}
			
// 			document.getElementById("inscricao_por_data").innerHTML = qtdInscricaoPorData_html.join('');
			
			datas = [];
    	
			
			
    	let i = 0
    	[# th:each="curso : ${cursos}"]  
    		var num = 0;
  			var str = [[${curso.titulo}]];
    		[# th:each="inscricao : ${inscricoes}"]   
    		
				var str2 = [[${inscricao.curso.titulo}]];
    			var dtInscricao = [[${inscricao.dtInscricao}]];
				if (str2 == str) {
					num += 1;
				}
				
			[/]
			
			classificacao[i] = [str, num];
			i++;
		[/]
		
		
		
		
		return classificacao;
    };
    
    
    google.charts.load("current", {packages:['corechart']});
    google.charts.setOnLoadCallback(drawChartData);
    
    function drawChartData() {
      var data = new google.visualization.DataTable();
      
      data.addColumn('string', 'Data');
      data.addColumn('number', 'Inscrições');
      
//       data.addRows([
//         ["Copper", 8.94],
//         ["Silver", 10.4],
//         ["Gold", 19.30],
//         ["Platinum", 21.45]
//       ]);
      
      
      
    for (let i = 0; i < qtdInscricaoPorData.length; i++) {
    	 data.addRows([
    	 	[qtdInscricaoPorData[i][0],qtdInscricaoPorData[i][1] ],
    	 ]);
	};
      


      var view = new google.visualization.DataView(data);
      view.setColumns([0, 1,
                       { calc: "stringify",
                         sourceColumn: 1,
                         type: "string",
                         role: "annotation" }
                       ]);

      var options = {
        title: "Quantidade de inscrições por dia",
        bar: {groupWidth: "95%"},
        legend: { position: "none" },
      };
      var chart = new google.visualization.ColumnChart(document.getElementById("columnchart_values"));
      chart.draw(view, options);
  }
    $(window).resize(function(){
    	drawChartData();
    	drawChart();
    	});
	</script>
</body>
</html>