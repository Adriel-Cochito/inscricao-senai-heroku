<!DOCTYPE html>
<html xmlns:layout="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.w3.org/1999/xhtml" layout:decorate="~{layout}">
<head>
<meta charset="UTF-8" />
<link rel="stylesheet"
	href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
<link th:href="@{/css/style.css(v=${version})}" rel="stylesheet" />

</head>
<body>

	<section class="layout-content" layout:fragment="corpo">
		<main role="main">

		<section class="jumbotron text-center">
			<div class="container">
				<h1 class="jumbotron-heading">Cadastro de Candidatos</h1>
				<p class="lead text-muted">Cadastro de dados pessoais</p>
			</div>
		</section>

		<div class="album py-5 bg-light">
			<div class="container rounded-3">

				<div class="d-flex justify-content-center rounded-3">
					<div class="col-md-8 shadow bg-white rounded-3"
						sec:authorize="hasAuthority('CANDIDATO')"
						style="background-color: white; padding: 40px; padding-top: 60px">

						<div th:replace="fragments/alert  :: alerta-sucesso"></div>

						<div class="add-toast position-absolute" aria-live="polite"
							aria-atomic="true" style="top: 0px; right: 20px;">
							<!--toast-->
						</div>

						<h3>Dados Pessoais</h3>

						<form
							th:action="${candidato.id == null} ? @{/candidatos/salvar} : @{/candidatos/editar}"
							th:object="${candidato}" method="POST" class="was-validated">

							<div class="form-row">
								<div class="form-group col-md-6">
									<label for="nome" class="form-group">Nome Completo</label> <input
										type="text" class="form-control" th:field="*{nome}" id="nome"
										placeholder="Escreva seu nome completo" required />
									<div class="invalid-feedback">Nome completo é requerido.</div>
								</div>
								<div class="form-group col-md-6">
									<label for="bairro" class="form-group">Bairro</label> <input
										type="text" class="form-control" th:field="*{bairro}"
										id="bairro" placeholder="Escreva seu Bairro" required />
									<div class="invalid-feedback">Bairro é requerido.</div>
								</div>
							</div>

							<div class="form-row">
								<div class="form-group col-md-6">
									<label for="telefone" class="form-group">Telefone com
										DDD</label> <input type="number" class="form-control"
										th:field="*{telefone}" id="telefone"
										placeholder="Exemplo: 34989887766" required />
									<div class="invalid-feedback">Telefone é requerido.</div>
								</div>

							</div>

							<div class="form-row">
								<div class="form-group col-md-6">
									<label for="dtNascimento">Data de Nascimento</label> <input
										type="date" class="form-control" id="dtNascimento"
										th:field="*{dtNascimento}" required />
									<div class="invalid-feedback">Data de Nascimento é
										requerida.</div>
								</div>
							</div>


							<hr>
							<h4>Renda Percapta</h4>
							<p><b>1 - </b>Escreva seu nome e renda, e clique em adicionar</p>
							<p><b>2 - </b>Escreva o nome, a renda e o grau de parentesco de cada pessoa que mora com você
								e clique em "Adicionar" para incluir na lista</p>
							<p><b>3 - </b>Adicione todos que moram com você, <b>mesmo que a renda seja R$0,00</b></p>

							<div class="form-row" style="width: 100%; margin-left: 0;">
								<h6>Adicionar um familiar</h6>
								<div class="input-group" style="width: 100%; margin-left: 0;">
									<input type="text" class="form-control" id="nomeFamiliar"  th:value="${nomeFamiliar}"
										style="width: 30px;" placeholder="Nome" required /> <input 
										type="number" class="form-control" id="valorRenda1"  th:value="${valor}"
										style="width: 30px;" placeholder="1000,00" required />
										<select class="form-control" required id="grauParentesco"
										 aria-label="Default select example">
										 <option value="Candidato">Minha renda</option>
										<option value="Pai/mãe">Pai ou mãe</option>
										<option value="Avô(ó)">Avô ou avó</option>
										<option value="Bisavô(ó)">Bisavô ou bisavó</option>
										<option value="Filho(a)">Filho ou filha</option>
										<option value="Neto(a)">Neto ou neta</option>
										<option value="Irmão(ã)">Irmão ou irmã</option>
										<option value="Tio(a)">Tio ou tia</option>
										<option value="Sobrinho(a)">Sobrinho ou sobrinha</option>
									</select>
									<div class="input-group-append">
										<span class="input-group-text"
											style="color: white; background-color: #007bff;"><a
											type="button" id="incluirDependente">Adicionar</a></span>
									</div>

									<div class="invalid-feedback">Nome e Renda são
										obrigatórios, mesmo que seja R$ 0,00.</div>
										
										
									<input type="hidden" 
											th:field="*{familiares}"
											id="familiares" />
											
											
								</div>
								
							</div>

							<div class="p-3 mb-5 rounded card" style="background-color: #ebeef2;padding: 20px;">
								<div id="resultado" class="form-group col-md-6" >
									<h6>Familiares cadastrados: </h6>
									[(${listaFamiliares})]
								</div>
							</div>


							<div class="form-row">
								<div class="form-group col-md-6">
									<label for="rendaPercapta" class="form-group">Resultado
										da sua Renda Percapita:</label>
									<div class="input-group mb-3">
										<div class="input-group-prepend">
											<span class="input-group-text">$</span>
										</div>
										<input type="number" step="1.00" min="0.00"
											class="form-control" th:field="*{rendaPercapta}"
											id="rendaPercapta" readonly placeholder="R$ 0,00" required />
										
										<div class="input-group-prepend">
											<span class="input-group-text">.00</span>
										</div>
										<div class="invalid-feedback">Renda é requerido.</div>
									</div>
								</div>
							</div>
							
<!-- 							<div class="form-group col-md-6"> -->
<!-- 									<label for="familiares" class="form-group">familiares</label> <input -->
<!-- 										type="text" class="form-control" th:field="*{familiares}" -->
<!-- 										id="familiares" placeholder="Escreva seu familiares" required /> -->
<!-- 									<div class="invalid-feedback">familiares é requerido.</div> -->
<!-- 							</div> -->
							
<!-- 							<div class="form-group col-md-6"> -->
<!-- 								<div id="familiares-html">Familiares resposta -->
<!-- 									<p id="familiares-html"></p> -->
<!-- 								</div> -->
<!-- 							</div>	 -->



							<input type="hidden" name="uid" th:field="*{usuario.id}">
							<input type="hidden" name="id" th:field="*{id}">

							<div class="form-group row"
								sec:authorize="hasAuthority('CANDIDATO')">
								<div class="col-sm-10">
									<button type="submit" class="btn btn-primary"
										data-toggle="tooltip" data-placement="right" title="Salvar">
										Salvar</button>
								</div>
							</div>
						</form>

					</div>
				</div>

				<div class="d-flex justify-content-center rounded-3"
					style="margin-top: 50px;">
					<div class="col-md-8 shadow bg-white rounded-3"
						sec:authorize="hasAuthority('CANDIDATO')"
						style="background-color: white; padding: 40px; padding-top: 60px">




						<h4>Dados Cadastrais</h4>

						<form th:action="@{/u/cadastro/salvar}" th:object="${usuario}"
							sec:authorize="hasAuthority('CANDIDATO')" method="POST"
							class="was-validated">

							<div class="mb-3">
								<label for="cpf">CPF</label>
								<div class="input-group">
									<div class="input-group-prepend">
										<span class="input-group-text"
											id="validationTooltipUsernamePrepend">@</span>
									</div>
									<input type="text" class="form-control" id="cpf"
										th:field="*{cpf}" placeholder="CPF"
										aria-describedby="validationTooltipUsernamePrepend" required />
									<div class="invalid-feedback">CPF é requerido.</div>
								</div>
							</div>

							<div class="mb-3">
								<label for="email">Email</label> <input type="email"
									class="form-control" id="email" placeholder="email"
									th:field="*{email}" />
								<div class="invalid-feedback">Email é requerido.</div>
							</div>


							<div class="mb-3">
								<label for="senha">Senha</label> <input type="password"
									class="form-control" id="senha" maxlength="6"
									th:field="*{senha}" placeholder="Insira sua senha de acesso"
									required />
								<div class="invalid-feedback">Senha é requerida para
									confirmar a operação.</div>
							</div>


							<!-- 							style="visibility:hidden;" -->
							<div class="mb-3">
								<label for="perfis">Perfil</label> <select id="perfis" disabled
									class="custom-select" size="4" th:field="*{perfis}" multiple
									required>
									<option value="1" sec:authorize="hasAuthority('ADMIN')">Administrador</option>
									<option value="2" sec:authorize="hasAuthority('ASSISTENTE')">Assistente</option>
									<option value="3">Candidato</option>
								</select> <input type="hidden" value="0" name="perfis">

								<div class="invalid-feedback">Pelo menos um perfil é
									requerido.</div>
							</div>

							<div class="mb-3">
								<div class="custom-control custom-switch">
									<input type="checkbox" class="custom-control-input" disabled
										th:field="*{ativo}" id="ativo"
										th:if="${ativo == true ? 'checked=checked' : ''}" /> <label
										class="custom-control-label" for="ativo">Cadastro
										Ativo para Inscrições</label>
								</div>
							</div>

							<input type="hidden" th:field="*{id}">
							<div class="form-group row">
								<div class="col-sm-10">
									<button type="submit" class="btn btn-primary"
										data-toggle="tooltip" data-placement="right" title="Salvar">
										Salvar</button>
								</div>
							</div>
						</form>
					</div>
				</div>



				<!-- 		------------------------------------------------------------------------------------------------------------------>


				<form
					th:action="${candidato.id == null} ? @{/candidatos/salvar} : @{/candidatos/editar}"
					th:object="${candidato}" method="POST" class="was-validated"
					sec:authorize="hasAnyAuthority('ADMIN','ASSISTENTE' )">

					<div class="form-row">
						<div class="form-group col-md-6">
							<label for="nome" class="form-group">Nome Completo</label> <input
								disabled="" type="text" class="form-control" th:field="*{nome}"
								id="nome" placeholder="João da Silva" required />
							<div class="invalid-feedback">Nome completo é requerido.</div>
						</div>
						<div class="form-group col-md-6">
							<label for="bairro" class="form-group">Bairro</label> <input
								disabled="" type="text" class="form-control"
								th:field="*{bairro}" id="bairro" placeholder="Bairro" required />
							<div class="invalid-feedback">Bairro é requerido.</div>
						</div>
					</div>

					<div class="form-row">
						<div class="form-group col-md-6">
							<label for="telefone" class="form-group">Telefone</label> <input
								disabled="" type="number" class="form-control"
								th:field="*{telefone}" id="telefone" placeholder="34988765456"
								required />
							<div class="invalid-feedback">Telefone é requerido.</div>
						</div>


						<div class="form-group col-md-6">
							<label for="rendaPercapta" class="form-group">Renda
								PerCapita</label> <input disabled="" type="number" class="form-control"
								th:field="*{rendaPercapta}" id="rendaPercapta"
								placeholder="2000,00" required />
							<div class="invalid-feedback">Renda é requerido.</div>
						</div>
					</div>

					<div class="form-row">
						<div class="form-group col-md-6">
							<label for="dtNascimento">Data de Nascimento</label> <input
								disabled type="date" class="form-control" id="dtNascimento"
								th:field="*{dtNascimento}" required />
							<div class="invalid-feedback">Data de Nascimento é
								requerida.</div>
						</div>
					</div>
					
					<div class="p-3 mb-5 rounded card" style="background-color: #ebeef2;padding: 20px;">
								<div id="resultado" class="form-group col-md-6" >
									<h6>Familiares cadastrados: </h6>
									[(${listaFamiliares})]
								</div>
							</div>

					<input type="hidden" name="uid" th:field="*{usuario.id}">
							<input type="hidden" name="id" th:field="*{id}">

				</form>
				<a class="btn btn-primary" type="button"
					href="javascript:history.back()"
					sec:authorize="hasAnyAuthority('ADMIN','ASSISTENTE' )">Voltar a
					página anterior</a>

				<hr />


			</div>
		</div>

		</main>

	</section>
	<script th:src="@{/js/candidato.js(v=${version})}" th:fragment="js"></script>
	<script th:inline="javascript" th:fragment="inlinescript"
		sec:authorize="hasAuthority('CANDIDATO')">
	
	$('#perfis').ready(function(){
		var perfis = [[${usuario.perfis}]];
		$.each(perfis, function(k, v) {
			$('#perfis option[value="'+ v.id +'"]').attr('selected', 'selected');
		})
	});
	
	console.log("Script executado!!!")
	
 	var nomesFamiliares = new Array();
	var rendaDependentes = new Array();
	var resultado = new Array();
	var listaFamiliares = new Array();
	var valor= 0 ;
	var removidos = 1;
	
	var lista_resultado = [];
	
// 	lista_resultado.push({ id: 1, nome: "nome 1", renda: 'renda 1'},);
// 	lista_resultado.push({ id: 2, nome: "nome 2", renda: 'renda 2'},);
	
	 
	 var removeFamiliar = function(id) {
		 
		 var index = 0;
		 var valor1 = 0;
		 console.log("Removendo : ", id)
		 
		
		  for(let i = 0; i < lista_resultado.length; i++ ) {
	        	if(lista_resultado[i].id == id) {
	        		lista_resultado.splice(i, 1);
	        	}
	    	};
// 			resultado.splice(index, 1);
// 			rendaDependentes.splice(index, 1);
// 			nomesFamiliares.splice(index, 1);
		 
	
// 		  console.log(resultado)
// 		  console.log("Removendo : ", valor)
// 		  removidos += 1;
		 chamaResultado();
		
	 };
	
	 var chamaResultado = function() {
		 valor = 0;
		 
		 for(let i = 0; i < lista_resultado.length; i++ ) {
	        	valor = parseInt(valor) + parseInt(lista_resultado[i].valor);
	    	};
		 	valor = valor / lista_resultado.length
		 	
	    	
	    	
		 	resultado = [];
	    	for(let i = 1; i <= lista_resultado.length; i++ ) {
	    		var x = i-1;
	    		resultado.push('<div class="form-row" style="width:100%;margin-left:0;">'+
	        	        '<h7>Familiar '+i+':</h7>'+
	        	        '<div class="input-group" style="width:100%;margin-left:0;">'+
	        				'<input type="text" class="form-control" value="'+lista_resultado[x].nome+'" id="" style="width:100px;" '+
	        					' placeholder=""  required  disabled />'+
	        				'<input type="text" class="form-control" value="'+lista_resultado[x].valor+'" id=""  style="width:100px;"'+
	        					' placeholder=""  required  disabled/>'+
	        				'<input type="text" class="form-control" value="'+lista_resultado[x].grauParentesco+'" id="" style="width:100px;" '+
	        					' placeholder=""  required  disabled />'+
	        				'<div class="input-group-append">'+
	        			    	'<span class="input-group-text" style="color:red;"><a type="button" onclick="removeFamiliar('+lista_resultado[x].id+')"">Remover</a></span></span>'+
	        			  	'</div>'+
	        			'<div class="invalid-feedback">Renda é requerida.</div>'+
	        			'</div>');
	    	};
	    	
	    	listaFamiliares = [];
	    	for(let i = 1; i <= lista_resultado.length; i++ ) {
	    		var x = i-1;
	    		listaFamiliares.push('<p>'+lista_resultado[x].nome+' : R$'+lista_resultado[x].valor + ' - '+lista_resultado[x].grauParentesco+'</p>');
	    	};
	    	
	    	valor = parseInt(valor);
	    	document.getElementById("resultado").innerHTML = resultado.join('');
	    	document.getElementById("rendaPercapta").value = valor;
	    	
	    	var familiares = listaFamiliares.join('').toString()
	    	console.log(familiares);
	    	document.getElementById("familiares").value = familiares;
	    	document.getElementById("familiares-html").innerHTML = familiares;
	    	
	 };
	 
    $('#incluirDependente').on('click', function () {
    	valor= 0 ;
    	var inputRenda = document.querySelector("#valorRenda1");
    	var nomeFamiliar= document.querySelector("#nomeFamiliar");
    	var grauParentesco= document.querySelector("#grauParentesco");
    	
    	if (inputRenda.value != "" && nomeFamiliar.value != "") {
    		
    		lista_resultado.push({ id: lista_resultado.length+1, nome: nomeFamiliar.value, valor: inputRenda.value, grauParentesco: grauParentesco.value},);
    		
    	var x = rendaDependentes.length
    	
    	
    	
    	
    	
    	chamaResultado();
    	}
    } );
	
	</script>

</body>
</html>